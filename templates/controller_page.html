<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='ATCPage.css') }}">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ callsign }} - ATC Dashboard</title>
    <link rel="icon" href="{{ url_for('static', filename='PF.png') }}">
    <style>
        /* Add CSS styles for different colors */
        .pilot-on-frequency {
            color: blue;
        }

        .pilot-on-other-frequency {
            color: green;
        }

        .squawk-alert {
            color: red;
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <h1>Welcome, {{ callsign }}</h1>
        <br>
      
        <h2>Connected Pilots:</h2>
        <br>
        <ul>
            {% for pilot in pilots %}
                <li class="{% if '7700' in pilots[pilot].squawk or '7600' in pilots[pilot].squawk or '7500' in pilots[pilot].squawk %}squawk-alert{% else %}{% if pilots[pilot].frequency == callsign %}pilot-on-frequency{% else %}pilot-on-other-frequency{% endif %}{% endif %}">
                    <strong>Callsign:</strong> <span class="{% if '7700' in pilots[pilot].squawk or '7600' in pilots[pilot].squawk or '7500' in pilots[pilot].squawk %}squawk-alert{% else %}{% if pilots[pilot].frequency == callsign %}pilot-on-frequency{% else %}pilot-on-other-frequency{% endif %}{% endif %}">{{ pilot }}</span> | 
                    <strong>Frequency:</strong> {{ pilots[pilot].frequency }} | 
                    <strong>Squawk:</strong> <span class="{% if '7700' in pilots[pilot].squawk or '7600' in pilots[pilot].squawk or '7500' in pilots[pilot].squawk %}squawk-alert{% endif %}">{{ pilots[pilot].squawk }}</span>
                    
                </li>
            <br>
            {% endfor %}
            <br>
        </ul>
        
        <!-- Add this section to display flight plans -->
        <h2>Flight Plans:</h2>
        <br>
        <ul>
            {% for pilot in pilots %}
                <li>
                    <strong>Callsign:</strong> {{ pilot }} | 
                    <strong>Aircraft Type:</strong> {{ pilots[pilot].aircraft }} | 
                    <strong>Flight Rules:</strong> {{ pilots[pilot].flightrules }} | 
                    <strong>Departure:</strong> {{ pilots[pilot].departure }} | 
                    <strong>Arrival:</strong> {{ pilots[pilot].arrival }} | 
                    <strong>FL:</strong> {{ pilots[pilot].cruise }} | 
                </li>
                <br>
            {% endfor %}
        </ul>
        <br>
        <!-- Add dropdown menus for selecting runways and SIDs -->
        <label for="runway">Select Runway:</label>
        <select id="runway" name="runway" onchange="populateSIDs()">
            <option value="" disabled selected>Select Runway</option>
            {% if callsign == "EGKK" %}
            <option value="26L">26L</option>
            <option value="08R">08R</option>
            {% elseif callsign == "GCLP" %}
            <option value="21L">21L</option>
            <option value="21R">21R</option>
            <option value="03R">03R</option>
            <option value="03L">03L</option>
            {% elseif callsign == "GVBA" %}
            <option value="03">03</option>
            <option value="21">21</option>
            {% elseif callsign == "LYTV" %}
            <option value="32">32</option>
            <option value="14">14</option>
            {% elseif callsign == "EFKT" %}
            <option value="34">34</option>
            <option value="16">16</option>
            {% endif %}
        </select>
        
        <label for="sid">Select SID:</label>
        <select id="sid" name="sid">
            <option value="" disabled selected>Select SID</option>
            <!-- Placeholders for SIDs -->
            <option value="SID1">SID1</option>
            <option value="SID2">SID2</option>
            <option value="SID3">SID3</option>
            <option value="SID4">SID4</option>
        </select>
        
        <!-- Add the "Request SSR" button -->
        <button type="button" class="btn" onclick="generateRandomSSR()">Request SSR</button>
        <br><br>
        <button type="button" class="btn">ATIS</button>
        <button type="button" class="btn">Charts</button>
        <a href="https://transponderserver.onrender.com/">
            <button type="button" class="btn1">Exit</button>
        </a>

        <!-- Inside controller_page.html -->
        
        </form>
      
        <script>
            // Function to generate a random SSR code within the specified ranges
            function generateRandomSSR() {
                var ranges = [
                    [0300, 0777],
                    [1001, 1077],
                    [1101, 1177],
                    [1201, 1777],
                    [3001, 3777],
                    [4001, 4777],
                    [5001, 5777],
                    [6001, 6777]
                ];

                // Keep generating SSR codes until one is found that doesn't contain 8 or 9
                while (true) {
                    // Randomly select a range
                    var rangeIndex = Math.floor(Math.random() * ranges.length);
                    var min = ranges[rangeIndex][0];
                    var max = ranges[rangeIndex][1];

                    // Generate a random number within the selected range
                    var randomSSR = Math.floor(Math.random() * (max - min + 1)) + min;

                    // Check if the SSR code contains 8 or 9
                    if (!/[89]/.test(randomSSR.toString())) {
                        // SSR code doesn't contain 8 or 9, break the loop
                        break;
                    }
                }

                // Alert or use the SSR as needed (e.g., send it to a server)
                alert("Random SSR: " + randomSSR);
            }

            // Function to populate the SIDs dropdown based on the selected runway
            function populateSIDs() {
                var runway = document.getElementById("runway
